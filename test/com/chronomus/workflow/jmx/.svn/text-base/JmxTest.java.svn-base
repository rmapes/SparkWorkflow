package com.chronomus.workflow.jmx;

import javax.management.MBeanServerConnection;
import javax.management.ObjectName;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;

import com.chronomus.workflow.jmx.JmxClient;
import com.chronomus.workflow.jmx.JmxServer;

import junit.framework.TestCase;

public class JmxTest extends TestCase {
	
	public void testSimpleCommand() throws Exception {
	    final int port = 9999;
		java.rmi.registry.LocateRegistry.createRegistry(port);
		JmxServer server = new JmxServer("localhost", port);
		// register test bean
		MockBean bean = new MockBean();
		bean.called = false;
		ObjectName mbeanName = server.register(bean);
		assertEquals(false, bean.called);
		// launch server
		server.start();
		assertEquals(false, bean.called);
		// Fire jmx request
		JmxClient client = new JmxClient(server.getConnectionString());
		client.invoke(mbeanName, "callObject");
		assertEquals(true, bean.called);	
		server.stop();
	}

}

